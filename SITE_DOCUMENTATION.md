# תיעוד מקיף - מערכת ש.ש ניהול תורים

## תוכן עניינים
1. [סקירה כללית](#סקירה-כללית)
2. [מבנה המערכת](#מבנה-המערכת)
3. [תפקידים והרשאות](#תפקידים-והרשאות)
4. [דפים ופלואו](#דפים-ופלואו)
5. [API Endpoints](#api-endpoints)
6. [מסד נתונים](#מסד-נתונים)
7. [עיצוב ו-UX](#עיצוב-ו-ux)
8. [תכונות מתקדמות](#תכונות-מתקדמות)
9. [גישות וטכנולוגיות](#גישות-וטכנולוגיות)

---

## סקירה כללית

**ש.ש ניהול תורים** היא מערכת ניהול תורים מקוונת מתקדמת המיועדת לעסקים קטנים ובינוניים (מספרות, מכוני יופי, מאמנים, מטפלים וכו').

### מטרת המערכת
- לאפשר לעסקים לנהל את התורים שלהם בצורה דיגיטלית
- לאפשר ללקוחות למצוא עסקים ולקבע תורים בקלות
- לספק כלי ניהול מתקדמים לבעלי עסקים
- לספק לוח בקרה למנהלי המערכת

### טכנולוגיות עיקריות
- **Frontend**: Next.js 14, React, TypeScript, Tailwind CSS
- **Backend**: Next.js API Routes
- **Database**: PostgreSQL (Neon Cloud)
- **ORM**: Prisma
- **Authentication**: Custom JWT-based session management
- **UI Components**: Radix UI, shadcn/ui

---

## מבנה המערכת

### מבנה תיקיות

```
src/
├── app/                    # דפים ו-API routes (Next.js App Router)
│   ├── api/               # API endpoints
│   ├── auth/              # דפי התחברות והרשמה
│   ├── business/          # דפי עסקים (ציבוריים)
│   ├── dashboard/         # דפי לוח בקרה (דורש התחברות)
│   └── page.tsx           # דף בית
├── components/            # רכיבי UI משותפים
│   ├── ui/               # רכיבי UI בסיסיים (buttons, cards, etc.)
│   └── ...               # רכיבים מותאמים אישית
└── lib/                  # פונקציות עזר
    ├── auth.ts           # ניהול אימות
    ├── db.ts             # חיבור למסד נתונים
    ├── roles.ts          # ניהול הרשאות
    └── ...
```

---

## תפקידים והרשאות

### 1. CUSTOMER (לקוח)
**מה הלקוח יכול לעשות:**
- ✅ לחפש עסקים לפי קטגוריה, עיר, שם
- ✅ לצפות בעמודי עסקים
- ✅ לקבוע תורים
- ✅ לראות את התורים שלו
- ✅ לבטל תורים (לפי מדיניות ביטול)
- ✅ להוסיף עסקים למועדפים
- ✅ לשלוח הודעות לעסקים
- ✅ לכתוב ביקורות
- ✅ לשתף עסקים

**מה הלקוח לא יכול לעשות:**
- ❌ לראות מחירון (רק בעל עסק רואה)
- ❌ לנהל עסקים
- ❌ לראות פרטים פרטיים של לקוחות אחרים
- ❌ לקבוע תורים חופפים (נבדק אוטומטית)
- ❌ לקבוע יותר מ-3 תורים ביום אחד לעסק

### 2. BUSINESS_OWNER (בעל עסק)
**מה בעל העסק יכול לעשות:**
- ✅ כל מה שלקוח יכול
- ✅ ליצור ולנהל עסקים
- ✅ לנהל שירותים ומחירון
- ✅ לפתוח תורים (slots) לפי שירות
- ✅ לראות ולאשר/לדחות תורים ממתינים
- ✅ לנהל צוות (staff)
- ✅ לנהל גלריית תמונות
- ✅ לנהל שעות עבודה
- ✅ לראות סטטיסטיקות
- ✅ לחסום לקוחות
- ✅ לראות הודעות מלקוחות
- ✅ להגיב לביקורות

**מה בעל העסק לא יכול לעשות:**
- ❌ לנהל משתמשים אחרים
- ❌ לראות עסקים של בעלי עסקים אחרים
- ❌ לגשת ללוח בקרה של אדמין

### 3. ADMIN (מנהל מערכת)
**מה המנהל יכול לעשות:**
- ✅ כל מה שלקוח ובעל עסק יכולים
- ✅ לראות את כל המשתמשים
- ✅ לשנות תפקידים של משתמשים
- ✅ לראות את כל העסקים
- ✅ לנהל מנויים של עסקים
- ✅ לראות סטטיסטיקות גלובליות
- ✅ לנהל את כל המערכת

---

## דפים ופלואו

### דפים ציבוריים (ללא התחברות)

#### 1. דף בית (`/`)
**תיאור**: דף נחיתה ראשי
**תכונות**:
- כותרת ותיאור המערכת
- כפתורי התחברות והרשמה
- סעיף "אודות המערכת"
- תוכניות מחיר (עדיין לא פעילות)

**רכיבים**:
- `Navbar` - תפריט עליון
- `AccessibilityPanel` - פאנל נגישות

#### 2. התחברות (`/auth/login`)
**תיאור**: דף התחברות למשתמשים קיימים
**תכונות**:
- שדה אימייל
- שדה סיסמה (עם אפשרות הצגה/הסתרה)
- טיפול בשגיאות
- קישור להרשמה

**פלואו**:
1. משתמש מזין אימייל וסיסמה
2. המערכת בודקת במסד הנתונים
3. אם תקין - יוצר session ו-redirect לפי תפקיד:
   - ADMIN → `/dashboard/admin`
   - BUSINESS_OWNER → `/dashboard/businesses`
   - CUSTOMER → `/dashboard/search`

#### 3. הרשמה (`/auth/register`)
**תיאור**: דף הרשמה למשתמשים חדשים
**תכונות**:
- שם מלא
- מספר טלפון
- אימייל
- סיסמה
- בחירת תפקיד (לקוח או בעל עסק)

**פלואו**:
1. משתמש ממלא פרטים
2. המערכת בודקת שאימייל לא קיים
3. יוצר משתמש חדש
4. מתחבר אוטומטית
5. Redirect לפי תפקיד

#### 4. עמוד עסק (`/business/[id]`)
**תיאור**: עמוד ציבורי של עסק
**תכונות**:
- שם העסק, קטגוריה, עיר
- לוגו
- גלריה
- שעות עבודה
- ביקורות
- כפתור "קבע תור"
- כפתור מועדפים
- כפתור שיתוף

**מה לקוח רואה**:
- ✅ כל המידע הציבורי
- ✅ ביקורות
- ✅ שעות עבודה
- ❌ מחירון (רק בעל עסק רואה)

**מה בעל עסק רואה**:
- ✅ כל מה שלקוח רואה
- ✅ מחירון
- ✅ כפתורי ניהול

#### 5. קביעת תור (`/business/[id]/book`)
**תיאור**: דף קביעת תור (דורש התחברות)
**תכונות**:
- בחירת שירות (אם יש)
- בחירת תאריך
- בחירת שעה
- אישור תור

**פלואו**:
1. משתמש בוחר שירות (אופציונלי)
2. המערכת מציגה תורים זמינים לפי השירות
3. משתמש בוחר תאריך ושעה
4. המערכת בודקת:
   - שאין תורים חופפים
   - שלא עבר מגבלת 3 תורים ביום
   - שהלקוח לא חסום
5. יוצר תור עם סטטוס PENDING
6. שולח נוטיפיקציה לבעל העסק
7. Redirect לדף התורים

### דפי לוח בקרה (דורש התחברות)

#### 1. חיפוש עסקים (`/dashboard/search`)
**תיאור**: דף חיפוש עסקים ללקוחות
**תכונות**:
- חיפוש לפי טקסט
- חיפוש לפי קטגוריה
- חיפוש לפי עיר
- תצוגת תוצאות בכרטיסים
- פילטרים

**פלואו**:
1. משתמש בוחר סוג חיפוש
2. מזין פרטים
3. המערכת מחפשת במסד הנתונים
4. מציג תוצאות
5. משתמש יכול ללחוץ על עסק → `/business/[id]`

#### 2. תור מהיר (`/dashboard/quick-book`)
**תיאור**: דף לקביעת תור מהיר
**תכונות**:
- חיפוש עסקים עם תורים זמינים
- פילטרים: קטגוריה, עיר, טווח זמן
- תצוגת תורים זמינים
- קביעת תור ישירה

#### 3. מועדפים (`/dashboard/favorites`)
**תיאור**: רשימת עסקים שמורים
**תכונות**:
- תצוגת כרטיסים של עסקים מועדפים
- מעבר לעמוד העסק
- הסרה ממועדפים

#### 4. התורים שלי (`/dashboard/appointments`)
**תיאור**: רשימת התורים של המשתמש
**תכונות**:
- תורים קרובים
- תורים עתידיים
- תורים עבר
- אפשרות ביטול (לפי מדיניות)

**פלואו**:
1. המערכת טוענת את כל התורים של המשתמש
2. ממיינת לפי תאריך
3. מציגה לפי סטטוס (PENDING, CONFIRMED, CANCELLED)
4. משתמש יכול לבטל תורים (אם מותר)

#### 5. יומן (`/dashboard/calendar`)
**תיאור**: תצוגת יומן של תורים
**תכונות**:
- תצוגה חודשית
- סימון ימים עם תורים
- מעבר לתור

#### 6. הפרופיל שלי (`/dashboard/profile`)
**תיאור**: דף פרופיל אישי
**תכונות**:
- עריכת פרטים אישיים
- שינוי סיסמה
- היסטוריית תורים

### דפי בעל עסק

#### 1. העסקים שלי (`/dashboard/businesses`)
**תיאור**: רשימת כל העסקים של בעל העסק
**תכונות**:
- תצוגת כרטיסים
- יצירת עסק חדש
- מעבר לניהול עסק

#### 2. ניהול עסק (`/dashboard/businesses/[id]`)
**תיאור**: דף ניהול עסק ספציפי
**תכונות**:
- תצוגת סקירה כללית
- תפריט ניווט:
  - עריכה
  - תורים
  - שירותים
  - צוות
  - גלריה
  - הגדרות
  - סטטיסטיקות

#### 3. יומן תורים (`/dashboard/businesses/[id]/appointments`)
**תיאור**: ניהול תורים של העסק
**תכונות**:
- רשימת תורים ממתינים לאישור (עם badge)
- תצוגת לוח שנה
- אישור/דחיית תורים
- חסימת לקוחות
- נוטיפיקציות על תורים חדשים

**פלואו**:
1. בעל עסק רואה תורים ממתינים
2. יכול לאשר או לדחות
3. כשמאשר - שולח נוטיפיקציה ללקוח
4. יכול לחסום לקוח (אז לא יוכל לקבוע תורים)

#### 4. ניהול שירותים (`/dashboard/businesses/[id]/services`)
**תיאור**: ניהול שירותים ומחירון
**תכונות**:
- יצירת שירות חדש
- עריכת שירות
- מחיקה
- הגדרת מחיר ומשך זמן

**חשוב**: המחירון נראה רק לבעל העסק, לא ללקוחות!

#### 5. פתיחת תורים (`/dashboard/businesses/[id]/schedule`)
**תיאור**: פתיחת תורים לפי שירות
**תכונות**:
- בחירת שירות
- בחירת תאריך
- בחירת שעות
- יצירת תורים (slots) לפי משך השירות

**פלואו**:
1. בעל עסק בוחר שירות
2. בוחר תאריך
3. בוחר שעות
4. המערכת יוצרת תורים לפי משך השירות (אם שירות 30 דקות, יוצר תורים של 30 דקות)

#### 6. ניהול צוות (`/dashboard/businesses/[id]/team`)
**תיאור**: ניהול צוות העסק
**תכונות**:
- הוספת עובד
- עריכת פרטי עובד
- מחיקה

#### 7. גלריה (`/dashboard/businesses/[id]/gallery`)
**תיאור**: ניהול תמונות העסק
**תכונות**:
- העלאת תמונות
- מחיקה
- קטגוריות (כללי, לפני/אחרי)

#### 8. הגדרות (`/dashboard/businesses/[id]/settings`)
**תיאור**: הגדרות העסק
**תכונות**:
- עריכת פרטים בסיסיים
- שעות עבודה
- מדיניות ביטול
- הגדרות נוספות

#### 9. סטטיסטיקות (`/dashboard/businesses/[id]/statistics`)
**תיאור**: סטטיסטיקות העסק
**תכונות**:
- מספר תורים
- הכנסות (משוערות)
- שירותים פופולריים
- ימים עמוסים

### דפי אדמין

#### 1. לוח בקרה (`/dashboard/admin`)
**תיאור**: לוח בקרה למנהל מערכת
**תכונות**:
- רשימת כל המשתמשים
- רשימת כל העסקים
- שינוי תפקידים
- ניהול מנויים

---

## API Endpoints

### Authentication
- `POST /api/auth/login` - התחברות
- `POST /api/auth/register` - הרשמה
- `POST /api/auth/logout` - התנתקות
- `GET /api/auth/user` - קבלת משתמש נוכחי
- `GET /api/auth/check-users` - בדיקת משתמשים (debug)
- `POST /api/auth/create-admin` - יצירת admin

### Businesses
- `GET /api/businesses` - רשימת עסקים
- `POST /api/businesses` - יצירת עסק
- `GET /api/businesses/[id]` - פרטי עסק
- `PUT /api/businesses/[id]` - עדכון עסק
- `DELETE /api/businesses/[id]` - מחיקת עסק
- `GET /api/businesses/search` - חיפוש עסקים
- `POST /api/businesses/[id]/block-customer` - חסימת לקוח
- `DELETE /api/businesses/[id]/block-customer` - שחרור לקוח
- `GET /api/businesses/[id]/block-customer` - רשימת לקוחות חסומים

### Appointments
- `GET /api/appointments` - רשימת תורים
- `POST /api/appointments` - יצירת תור
- `PUT /api/appointments/[id]` - עדכון תור (שינוי סטטוס)
- `POST /api/appointments/[id]/cancel` - ביטול תור

### TimeSlots
- `GET /api/timeslots/available` - תורים זמינים
- `POST /api/timeslots/book` - קביעת תור
- `POST /api/timeslots/create` - יצירת תורים
- `POST /api/timeslots/[id]/approve` - אישור תור
- `POST /api/timeslots/[id]/reject` - דחיית תור
- `POST /api/timeslots/[id]/block` - חסימת תור

### Services
- `GET /api/services` - רשימת שירותים
- `POST /api/services` - יצירת שירות
- `GET /api/services/[id]` - פרטי שירות
- `PUT /api/services/[id]` - עדכון שירות
- `DELETE /api/services/[id]` - מחיקת שירות

### Notifications
- `GET /api/notifications` - רשימת הודעות
- `PUT /api/notifications` - סימון הודעה כנקראה

### Favorites
- `GET /api/favorites` - רשימת מועדפים
- `POST /api/favorites` - הוספה למועדפים
- `DELETE /api/favorites` - הסרה ממועדפים

### Reviews
- `GET /api/reviews` - רשימת ביקורות
- `POST /api/reviews` - יצירת ביקורת
- `POST /api/reviews/[id]/reply` - תגובה לביקורת

### Messages
- `GET /api/messages` - רשימת הודעות
- `POST /api/messages` - שליחת הודעה

---

## מסד נתונים

### Models עיקריים

#### User
- `id` - מזהה ייחודי
- `email` - אימייל (ייחודי)
- `passwordHash` - סיסמה מוצפנת
- `fullName` - שם מלא
- `phone` - טלפון
- `role` - תפקיד (CUSTOMER, BUSINESS_OWNER, ADMIN)
- `isBlocked` - האם חסום גלובלית
- `cancellationCount` - מספר ביטולים
- `createdAt`, `updatedAt` - תאריכים

#### Business
- `id` - מזהה ייחודי
- `name` - שם העסק
- `category` - קטגוריה
- `city` - עיר
- `address` - כתובת
- `description` - תיאור
- `logo` - לוגו
- `phone` - טלפון
- `ownerId` - בעל העסק
- `subscriptionPlan` - תוכנית מנוי
- `cancellationPolicy` - מדיניות ביטול
- `workingHours` - שעות עבודה (JSON)
- `latitude`, `longitude` - קואורדינטות
- `createdAt`, `updatedAt` - תאריכים

#### Service
- `id` - מזהה ייחודי
- `businessId` - עסק
- `name` - שם השירות
- `description` - תיאור
- `price` - מחיר
- `duration` - משך זמן (דקות)
- `createdAt` - תאריך יצירה

#### Appointment
- `id` - מזהה ייחודי
- `businessId` - עסק
- `customerId` - לקוח
- `serviceId` - שירות (אופציונלי)
- `startTime` - זמן התחלה
- `endTime` - זמן סיום
- `status` - סטטוס (PENDING, CONFIRMED, CANCELLED)
- `notes` - הערות
- `createdAt` - תאריך יצירה

#### TimeSlot
- `id` - מזהה ייחודי
- `businessId` - עסק
- `date` - תאריך
- `startTime` - שעת התחלה
- `endTime` - שעת סיום
- `isBooked` - האם תפוס
- `bookedById` - מי קבע (אם תפוס)
- `createdAt` - תאריך יצירה

#### BlockedCustomer
- `id` - מזהה ייחודי
- `businessId` - עסק
- `customerId` - לקוח חסום
- `reason` - סיבת חסימה
- `createdById` - מי חסם
- `createdAt` - תאריך חסימה

#### Notification
- `id` - מזהה ייחודי
- `userId` - משתמש
- `businessId` - עסק (אופציונלי)
- `appointmentId` - תור (אופציונלי)
- `type` - סוג (APPOINTMENT_PENDING, APPOINTMENT_CONFIRMED, etc.)
- `title` - כותרת
- `message` - הודעה
- `isRead` - האם נקראה
- `createdAt` - תאריך יצירה

---

## עיצוב ו-UX

### עקרונות עיצוב
1. **RTL Support** - כל הטקסטים בעברית עם תמיכה מלאה ב-RTL
2. **Responsive Design** - עיצוב מותאם למובייל, טאבלט ומחשב
3. **Accessibility** - תמיכה בנגישות (גודל טקסט, ניגודיות)
4. **Dark Mode** - תמיכה במצב כהה
5. **Card-based Layout** - עיצוב מבוסס כרטיסים
6. **Clean & Modern** - עיצוב נקי ומודרני

### רכיבי UI עיקריים
- **Navbar** - תפריט עליון עם נוטיפיקציות
- **Sidebar** - תפריט צד (דסקטופ)
- **MobileNav** - תפריט תחתון (מובייל)
- **Cards** - כרטיסים למידע
- **Buttons** - כפתורים עם variants
- **Forms** - טפסים עם validation
- **Modals/Dialogs** - חלונות מודאליים
- **Toasts** - הודעות זמניות

### צבעים
- Primary: #2563EB (כחול)
- Secondary: #14B8A6 (טורקיז)
- Accent: #F97316 (כתום)
- Success: ירוק
- Error: אדום
- Warning: צהוב

---

## תכונות מתקדמות

### 1. מערכת נוטיפיקציות
- הודעות אוטומטיות על שינויי סטטוס תורים
- Badge עם כמות הודעות חדשות
- סימון הודעות כנקראו

### 2. חסימת לקוחות
- בעל עסק יכול לחסום לקוח
- לקוח חסום לא יכול לקבוע תורים
- רשימת לקוחות חסומים

### 3. בדיקות תקינות
- מניעת תורים חופפים
- מגבלת 3 תורים ביום לעסק
- בדיקת חסימות
- בדיקת מדיניות ביטול

### 4. ניהול שירותים
- יצירת שירותים עם מחיר ומשך זמן
- תורים לפי שירות
- מחירון (רק לבעל עסק)

### 5. מערכת מועדפים
- הוספת עסקים למועדפים
- כפתור לב ברור
- רשימת מועדפים

---

## גישות וטכנולוגיות

### Frontend
- **Next.js 14** - Framework עם App Router
- **React 18** - ספריית UI
- **TypeScript** - טייפ-ספייפי
- **Tailwind CSS** - עיצוב
- **Radix UI** - רכיבי UI נגישים
- **shadcn/ui** - ספריית רכיבים

### Backend
- **Next.js API Routes** - API endpoints
- **Prisma** - ORM למסד נתונים
- **bcryptjs** - הצפנת סיסמאות
- **JWT** - ניהול sessions

### Database
- **PostgreSQL** - מסד נתונים
- **Neon** - Cloud hosting
- **Prisma Migrations** - ניהול סכמה

### Authentication
- Custom JWT-based sessions
- Cookies עם httpOnly
- Role-based access control

### Security
- Password hashing עם bcrypt
- SQL injection protection (Prisma)
- XSS protection (React)
- CSRF protection (Next.js)

---

## הערות חשובות

### מה לקוח רואה
- ✅ עמוד עסק
- ✅ ביקורות
- ✅ שעות עבודה
- ✅ גלריה
- ❌ מחירון (רק בעל עסק)

### מה בעל עסק רואה
- ✅ כל מה שלקוח רואה
- ✅ מחירון
- ✅ ניהול תורים
- ✅ ניהול שירותים
- ✅ ניהול צוות
- ✅ סטטיסטיקות

### מה אדמין רואה
- ✅ כל מה שכל אחד רואה
- ✅ ניהול משתמשים
- ✅ ניהול כל העסקים
- ✅ לוח בקרה גלובלי

---

## פלואו עיקרי

### פלואו לקוח
1. התחברות/הרשמה
2. חיפוש עסקים
3. בחירת עסק
4. קביעת תור (בחירת שירות → תאריך → שעה)
5. אישור תור
6. קבלת נוטיפיקציה על אישור/דחייה
7. צפייה בתורים שלי

### פלואו בעל עסק
1. התחברות/הרשמה
2. יצירת עסק
3. הוספת שירותים
4. פתיחת תורים לפי שירות
5. קבלת נוטיפיקציות על תורים חדשים
6. אישור/דחיית תורים
7. ניהול עסק (צוות, גלריה, הגדרות)

### פלואו אדמין
1. התחברות
2. גישה ללוח בקרה
3. ניהול משתמשים
4. ניהול עסקים
5. שינוי תפקידים
6. ניהול מנויים

---

## שיפורים עתידיים

1. ✅ חסימת לקוחות - הושלם
2. ✅ מערכת נוטיפיקציות - הושלם
3. ✅ בחירת שירות - בתהליך
4. ⏳ תשלומים אונליין
5. ⏳ תזכורות אימייל
6. ⏳ אפליקציית מובייל
7. ⏳ Push notifications
8. ⏳ Analytics מתקדמים

---

## שיפורים אחרונים

### ✅ הושלם
1. **בחירת שירות בקביעת תור** - לקוח יכול לבחור שירות ספציפי ולראות תורים זמינים לפי השירות
2. **פתיחת תורים לפי שירות** - בעל עסק יכול לפתוח תורים לפי שירות ספציפי
3. **בדיקת תורים חופפים** - המערכת מונעת קביעת תורים חופפים
4. **הסתרת פרטים פרטיים** - אימיילים ופרטים פרטיים לא מוצגים בפומבי
5. **הסתרת מחירון** - מחירון נראה רק לבעל העסק
6. **ניקוי אוטומטי** - תורים ישנים נמחקים אוטומטית (API endpoint)
7. **שיפור עיצוב** - עיצוב מודרני עם gradients, shadows, transitions
8. **Responsive Design** - עיצוב מותאם למובייל, טאבלט ומחשב

### 🔄 בתהליך
- שיפורי error handling ו-validation
- שיפור פלואו לכל תפקיד

---

**עודכן לאחרונה**: 2024-12-01

